(function(){var a=document.id;this.TabPane=new Class({Implements:[Events,Options],options:{tabSelector:".tab",contentSelector:".content",activeClass:"active",ctrl:false,alt:false,shift:false,prefixTab:"tab_",prefixPanel:"panel_",index:0,tabWithFocus:null,panelWithFocus:null,imageWithFocus:null,tabGroup:".tabs"},container:null,showNow:false,tabs:null,contents:null,initialize:function(b,c){this.setOptions(c);this.container=document.id(b);this.tabs=this.container.getChildren(this.options.tabGroup)[0].getChildren(this.options.tabSelector);this.contents=this.container.getChildren(this.options.contentSelector);this.tabs[0].addClass(this.options.activeClass);this.contents.setStyle("display","none");this.contents[0].setStyle("display","block");this.container.addEvent("click:relay("+this.options.tabSelector+")",function(e,d){this.showTab(this.tabs.indexOf(d),d)}.bind(this));this.updateTabIndex();this.container.getChildren("ul").setProperty("role","tablist");this.tabs.each(function(f,e){var d=new Element("img",{src:"tabPane/img/close.gif",alt:"Remove tab with space or enter",width:"8px",height:"7px"});if(f.getChildren()[0]!=null){f.addClass("delete");f.getChildren()[0].appendChild(d,"top");clone=f.getChildren()[0].clone(true,true).inject(f,"after");f.getChildren()[0].destroy()}if(f.getNext()!=null){if(f.getNext().get("tag")=="span"){f.getNext().addEvents({keydown:function(i){keyCode=this.getKeyCode(i);switch(keyCode){case this.keys.KEY_ENTER:case this.keys.KEY_SPACE:var h=this.tabs.indexOf(this.container.getElement("."+this.options.activeClass));this.closeTab(h);break;case this.keys.KEY_TAB:f.getNext().setProperty("tabindex","-1");break;case this.keys.KEY_UP:if(i.control){i.stop();f.focus();this.options.ctrl=false;break}else{if(this.options.tabWithFocus==null){break}if(anzTabs<=1){break}if(previous==null){this.activateTab(last,lastContent)}else{this.activateTab(previous,previousContent)}this.inactivateTab(thiz,thisContent);break}break;default:break}}.bind(this)})}}f.addEvent("focus",function(h){this.options.tabWithFocus=f;this.options.panelWithFocus=null;this.updateTabIndex()}.bind(this));f.addEvent("blur",function(){this.options.tabWithFocus=null}.bind(this));f.setProperty("role","tab");f.setProperty("id",this.options.prefixTab+this.options.index);var g=this.contents[e];g.setProperty("id",this.options.prefixPanel+this.options.index);g.addEvent("focus",function(){this.options.panelWithFocus=g}.bind(this));g.addEvent("blur",function(){}.bind(this));g.setProperty("role","tabpanel");g.setProperty("aria-labelledby",this.options.prefixTab+this.options.index);if(e==0){g.setProperty("aria-hidden","false");f.setProperty("aria-selected","true")}else{g.setProperty("aria-hidden","true");f.setProperty("aria-selected","false")}this.options.index++}.bind(this))},showTab:function(b,c){var d=this.contents[b];if(!c){c=this.tabs[b]}if(d){this.contents.each(function(e){e.setStyle("display","none")});this.tabs.each(function(e){e.removeClass(this.options.activeClass)}.bind(this));c.addClass(this.options.activeClass);d.setStyle("display","block");this.fireEvent("change",b)}this.updateTabIndex()},closeTab:function(b){var c=this.tabs.indexOf(this.container.getElement("."+this.options.activeClass));if(!this.getClosingImage(this.tabs[c])){return}this.tabs[c].getNext().destroy();this.tabs[c].destroy();this.contents[c].destroy();this.fireEvent("close",c);cutt1=this.tabs.slice(0,c);cutt2=this.tabs.slice(c+1,this.tabs.length);this.tabs=cutt1.concat(cutt2);cutc1=this.contents.slice(0,c);cutc2=this.contents.slice(c+1,this.contents.length);this.contents=cutc1.concat(cutc2);this.options.index--;if(this.tabs.length!=0){if(c==this.tabs.length){c--}this.activateTab(this.tabs[c],this.contents[c])}},updateTabIndex:function(){this.tabs.each(function(c,b){if(c.hasClass(this.options.activeClass)){c.setProperty("tabindex",0);this.contents[b].setProperty("tabindex",0);this.contents[b].setProperty("aria-hidden","false");c.setProperty("aria-selected","true");if(this.getClosingImage(c)){this.getClosingImage(c).setProperty("tabindex","0")}}else{c.setProperty("tabindex",-1);this.contents[b].setProperty("tabindex",-1);this.contents[b].setProperty("aria-hidden","true");c.setProperty("aria-selected","false");if(this.getClosingImage(c)){this.getClosingImage(c).setProperty("tabindex","-1")}}}.bind(this))},keys:{KEY_TAB:9,KEY_ENTER:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_SPACE:32,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DEL:46},getKeyCode:function(b){var c;if(window.event){c=window.event.keyCode}else{c=b.code}return c},activateTab:function(b,c){if(b.getProperty("tabindex")==0){return}setTimeout(function(){b.focus()},0);b.setProperty("tabindex",0);c.setProperty("tabindex",0);b.addClass(this.options.activeClass);c.setStyle("display","block");c.setProperty("aria-hidden","false");b.setProperty("aria-selected","true");if(this.getClosingImage(b)){this.getClosingImage(b).setProperty("tabindex","0")}},inactivateTab:function(b,c){if(!b||b.getProperty("tabindex")==-1){return}b.setProperty("tabindex",-1);b.removeClass(this.options.activeClass);c.setStyle("display","none");c.setProperty("aria-hidden","true");b.setProperty("aria-selected","false");c.setProperty("tabindex",-1);if(this.getClosingImage(b)){this.getClosingImage(b).setProperty("tabindex","-1")}},getClosingImage:function(b){if(b.getNext()!=null){if(b.getNext().get("tag")=="span"){return b.getNext().getFirst()}}return null},onFocusElement:function(b){alert();this.options.tabWithFocus=element;this.options.panelWithFocus=null},onBlurElement:function(){this.options.tabWithFocus=null},onFocusContent:function(){},onBlurContent:function(){},onKeyDown:function(b){var o=this.getKeyCode(b);var i=this.tabs.indexOf(this.container.getElement("."+this.options.activeClass));var m=this.tabs.length;var e=this.tabs[0];var n=this.tabs[m-1];var f=this.tabs[i+1];var h=this.tabs[i-1];var g=this.tabs[i];var l=this.contents[0];var k=this.contents[m-1];var c=this.contents[i+1];var j=this.contents[i-1];var d=this.contents[i];switch(o){case this.keys.KEY_LEFT:b.stop();if(this.options.tabWithFocus==null){break}if(this.options.ctrl){break}if(m<=1){break}if(h==null){this.activateTab(n,k)}else{this.activateTab(h,j)}this.inactivateTab(g,d);break;case this.keys.KEY_UP:b.stop();if(b.control){b.stop();if(this.options.panelWithFocus==null){break}i=parseInt(this.options.panelWithFocus.getAttribute("aria-labelledby").replace(this.options.prefixTab,""));this.tabs[i].focus();this.options.ctrl=false;break}else{b.stop();g.focus();break}case this.keys.KEY_DOWN:b.stop();d.focus();break;case this.keys.KEY_RIGHT:if(this.options.tabWithFocus==null){break}if(this.options.ctrl){break}if(m<=1){break}b.stop();if(f==null){this.activateTab(e,l)}else{this.activateTab(f,c)}this.inactivateTab(g,d);break;case this.keys.KEY_PAGEUP:if(m<=1){break}if(this.options.ctrl){if(this.options.panelWithFocus==null){break}i=parseInt(this.options.panelWithFocus.getAttribute("aria-labelledby").replace(this.options.prefixTab,""));if((i-1)<0){this.activateTab(this.tabs[m-1],this.contents[m-1])}else{this.activateTab(this.tabs[i-1],this.contents[i-1])}this.inactivateTab(this.tabs[i],this.contents[i]);this.options.ctrl=false}break;case this.keys.KEY_PAGEDOWN:if(m<=1){break}if(this.options.ctrl){if(this.options.panelWithFocus==null){break}i=parseInt(this.options.panelWithFocus.getAttribute("aria-labelledby").replace(this.options.prefixTab,""));if((i+1)>(m-1)){this.activateTab(this.tabs[0],this.contents[0])}else{this.activateTab(this.tabs[i+1],this.contents[i+1])}this.inactivateTab(this.tabs[i],this.contents[i]);this.options.ctrl=false}break;case this.keys.KEY_DEL:if(this.options.alt){if(this.options.tabWithFocus==null){break}this.closeTab(i)}break;case this.keys.KEY_CTRL:this.options.ctrl=true;break;case this.keys.KEY_ALT:this.options.alt=true;break;case this.keys.KEY_SHIFT:this.options.shift=true;break;case this.keys.KEY_HOME:if(this.options.ctrl){break}if(this.options.tabWithFocus==null){break}if(m<=1){break}b.stop();if(e==g){break}this.activateTab(e,l);this.inactivateTab(g,d);break;case this.keys.KEY_END:if(this.options.ctrl){break}if(this.options.tabWithFocus==null){break}if(m<=1){break}b.stop();if(n==g){break}this.activateTab(n,k);this.inactivateTab(g,d);break}},onKeyUp:function(b){var c=this.getKeyCode(b);switch(c){case this.keys.KEY_CTRL:this.options.ctrl=false;break;case this.keys.KEY_ALT:this.options.alt=false;break}}})})();